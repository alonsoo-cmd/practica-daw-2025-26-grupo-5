<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Settings</title>
    <link rel="icon" type="image/png" href="/images/logo.png">

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg bg-white py-3 border-bottom sticky-top shadow-sm px-4">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center gap-2" href="/">
                <img src="/images/logo.png" alt="Stilnovo" width="35">
                <span class="brand" style="font-size: 1.2rem;">Stilnovo</span>
            </a>
            
            <div class="d-flex align-items-center gap-4">
                <a href="/user-page" class="btn-about py-2 px-3 small text-decoration-none fw-700">
                    <i class="fa-solid fa-arrow-left me-2"></i>Back to Dashboard
                </a>
            </div>
        </div>
    </nav>

    <main class="settings-page-container pb-5">
        <div class="container py-5">
            <div class="row g-5">
                
                <div class="col-lg-5">
                    <div class="clay-card p-4 p-md-5 settings-card">
                        <h2 class="fw-800 mb-4">Edit Profile</h2>
                        
                        <form action="/user-settings/edit" method="post" enctype="multipart/form-data">            

                            <input type="hidden" name="_csrf" value="{{token}}"/>
                            
                            <div class="mb-5 text-center">
                                <div class="profile-upload-container mx-auto mb-2">
                                    <img src="/user/me/profile-photo" id="preview-avatar" class="img-fluid rounded-circle p-1" 
                                            alt="Profile" style="width: 120px; height: 120px; object-fit: cover;"
                                            onerror="this.src='/images/profile-photo.png'">
                                    
                                    <input type="file" id="profilePic" name="newProfilePhoto" accept="image/*" class="file-input-hidden" onchange="previewImage(this)">
                                </div>
                                <label for="profilePic" class="form-label fw-700 small cursor-pointer" style="color: var(--brand-blue)">
                                    <i class="fa-solid fa-camera me-1"></i> Change profile picture
                                </label>
                            </div>

                            <p class="label-categories mb-3 opacity-50 fw-800 x-small text-uppercase">Account Details</p>
                            
                            <div class="mb-4">
                                <label class="label-categories mb-2 d-block">FULL NAME</label>
                                <div class="search-box w-100 py-2 locked-field">
                                    <i class="fa-solid fa-lock small text-muted"></i>
                                    <input type="text" value="{{user.name}}" disabled>
                                </div>
                                <div class="d-flex align-items-center gap-2 mt-2 px-1">
                                    <i class="fa-solid fa-circle-exclamation x-small text-primary"></i>
                                    <span class="x-small text-muted fw-600 italic">Usernames are unique identifiers and cannot be changed.</span>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="label-categories mb-2 d-block">EMAIL ADDRESS</label>
                                <div class="search-box w-100 py-2">
                                    <i class="fa-solid fa-envelope small"></i>
                                    <input type="email" name="newEmail" value="{{user.email}}" required>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="label-categories mb-2 d-block">PROFILE DESCRIPTION</label>
                                <textarea name="newDescription" class="search-box w-100 description-box" 
                                        placeholder="Tell the community about your collection history...">{{#user.userDescription}}{{user.userDescription}}{{/user.userDescription}}</textarea>
                            </div>

                            <hr class="my-4 opacity-10">

                            <p class="label-categories mb-3 opacity-50 fw-800 x-small text-primary text-uppercase">Billing Information</p>

                            <div class="mb-3">
                                <label class="label-categories mb-2 d-block">CARD NUMBER</label>
                                <div class="search-box w-100 py-2">
                                    <i class="fa-solid fa-credit-card small"></i>
                                    <input type="text" name="newCardNumber" value="{{#user.cardNumber}}{{user.cardNumber}}{{/user.cardNumber}}" maxlength="16">
                                </div>
                            </div>

                            <div class="row g-3 mb-4">
                                <div class="col-7">
                                    <label class="label-categories mb-2 d-block">EXPIRING DATE</label>
                                    <div class="search-box w-100 py-2">
                                        <i class="fa-solid fa-calendar-days small"></i>
                                        <input type="text" name="newCardExpiringDate" value="{{#user.cardExpiringDate}}{{user.cardExpiringDate}}{{/user.cardExpiringDate}}" placeholder="MM/YY" maxlength="5">
                                    </div>
                                </div>
                                <div class="col-5">
                                    <label class="label-categories mb-2 d-block">CVV</label>
                                    <div class="search-box w-100 py-2 cvv-wrapper">
                                        <i class="fa-solid fa-lock small"></i>
                                        <input type="password" name="newCardCvv" id="cardCvv" value="{{#user.cardCvv}}{{user.cardCvv}}{{/user.cardCvv}}" maxlength="3" style="flex: 1; border:none; outline:none; background:transparent;">
                                        <i class="fa-solid fa-eye toggle-password" id="toggleCvv"></i>
                                    </div>
                                </div>
                            </div>
    
                            <button type="submit" class="btn-sell w-100 justify-content-center mb-5">Save All Changes</button>
                        </form>

                        <hr class="my-5 opacity-10">
                        
                        <div class="text-center">
                            <button type="button" class="btn btn-danger-custom w-100 py-3 small shadow-sm" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                                <i class="fa-solid fa-user-slash me-2"></i>Permanently Delete Account
                            </button>
                        </div>
                    </div>
                </div>
    
                <div class="col-lg-7 text-center">
                    <div class="sticky-card-column">
                        <p class="label-categories mb-4 opacity-50 fw-700">YOUR DIGITAL SELLER CARD</p>
                        
                        <div class="flip-card-container mx-auto mb-5">
                            <div class="flip-card-lizard">
                                <div class="flip-card-inner-lizard">
                                    <div class="flip-card-front-lizard text-start">
                                        <div class="lizard-bg-pattern"></div>
                                        <div class="lizard-content">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div class="lizard-logo text-white">STILNOVO</div>
                                                <div class="lizard-chip"></div>
                                            </div>
                                            <div class="lizard-user mt-4">
                                                <h3 class="fw-800 text-uppercase">{{user.name}}</h3>
                                                <p class="lizard-id">ID: 2026-ST-{{user.userId}}</p>
                                            </div>
                                            <div class="lizard-footer d-flex justify-content-between align-items-end">
                                                <div class="lizard-valid">
                                                    <span>VALID THRU</span>
                                                    <p>{{#user.cardExpiringDate}}{{user.cardExpiringDate}}{{/user.cardExpiringDate}}</p>
                                                </div>
                                                <div class="lizard-brand-mark">PREMIUM SELLER</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flip-card-back-lizard">
                                        <i class="fa-solid fa-qrcode fa-5x"></i>
                                        <p class="x-small mt-3 opacity-50">SCAN TO FINALIZE DEAL</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-start mt-4 px-lg-5">
                            <div class="tip-card-blue mb-4">
                                <h6 class="fw-800 text-primary mb-2">
                                    <i class="fa-solid fa-handshake me-2"></i>Secure Physical Delivery
                                </h6>
                                <p class="small text-muted mb-0">Meeting the buyer in person? Once they have the item, let them scan your <strong>QR Code</strong> to instantly mark the transaction as completed and release your payment.</p>
                            </div>

                            <div class="tip-card-blue mb-4">
                                <h6 class="fw-800 text-dark mb-2">
                                    <i class="fa-solid fa-shield-halved me-2"></i>Fraud Protection
                                </h6>
                                <p class="small text-muted mb-0">The dynamic QR code links your Digital Card directly to the transaction, ensuring that only the verified owner can authorize the final delivery.</p>
                            </div>

                            <div class="p-3 text-center opacity-50">
                                <p class="x-small fw-600 mb-0"><i class="fa-solid fa-lock me-1"></i> Stilnovo Encryption Secured</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="clay-card modal-content p-4 border-0 shadow-lg">
                <div class="text-center mb-4">
                    <div class="bg-danger bg-opacity-10 p-3 rounded-circle d-inline-block mb-3">
                        <i class="fa-solid fa-triangle-exclamation text-danger fa-2x"></i>
                    </div>
                    <h3 class="fw-800 h5 mb-2 text-danger">Confirm Account Deletion</h3>
                    <p class="small text-muted">Hi {{user.name}}, are you sure you want to leave us? This action will permanently remove all your products and history.</p>
                </div>
                
                <form action="/user-settings/delete" method="post">
                    <input type="hidden" name="_csrf" value="{{token}}"/>
                    
                    <div class="mb-4">
                        <div class="p-3 bg-light rounded-4">
                            <div class="d-flex align-items-center gap-2 mb-2">
                                <i class="fa-solid fa-check-circle text-success small"></i>
                                <span class="x-small fw-700 text-uppercase">Cascading Deletion Active</span>
                            </div>
                            <p class="x-small text-muted mb-0">All linked items in your collection will be automatically removed from the marketplace.</p>
                        </div>
                    </div>

                    <div class="d-flex flex-column gap-2">
                        <button type="submit" class="modal-delete-danger btn-sell w-100 py-3 border-0 text-white shadow-sm">
                            Confirm and Delete
                        </button>
                        <button type="button" class="btn btn-link text-muted fw-700 text-decoration-none small mt-2" data-bs-dismiss="modal">
                            Cancel, I want to stay
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // LIVE IMAGE PREVIEW
        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview-avatar').src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // CVV TOGGLE LOGIC
        const toggleCvv = document.querySelector('#toggleCvv');
        const cvvInput = document.querySelector('#cardCvv');
        toggleCvv.addEventListener('click', function () {
            const type = cvvInput.getAttribute('type') === 'password' ? 'text' : 'password';
            cvvInput.setAttribute('type', type);
            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
        });
    </script>
</body>
</html>